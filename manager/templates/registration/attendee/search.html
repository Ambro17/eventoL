{% extends "generic-bootstrap-model-form.html" %}
{% load staticfiles %}
{% load i18n %}

{% block other-head %}
    {% include 'autocomplete_light/static.html' %}
{% endblock %}

{% block page-header %}{% trans "Attendee Registration" %}{% endblock %}

{% block page-name %}{% trans "Attendee Registration" %}{% endblock %}

{% block pre-form %}
    <div class="alert alert-warning alert-dismissable">
        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
        <span class="fa fa-info-circle fa-5x"></span>
        <ul>
            <li>Buscar a un asistente para una event, en caso que el asistente se haya registrado. Si no aparece como
                sugerido en la lista, es porque no termin칩 correctamente el proceso de registro.
            </li>
            <li>Si aparece sugerido en la lista, quiere decir que se registr칩 correctamente. En ese caso, seleccionarlo
                y presionar "<strong>Marcar como Presente</strong>". Esto har치 que se marque como "Presente" (o sea, que
                asisiti칩 al evento).
            </li>
            <li>Si no aparece sugerido, hacer click en "<strong>Registrar Nuevo Asistente</strong>" y cargar los datos
                del mismo.
            </li>
    </div>
{% endblock %}

{% block form-id %}"registration"{% endblock %}

{% block form-name %}{% trans "Attendee Registration" %}{% endblock %}

{% block form-action %}"{% url "attendee_search" event_slug %}"{% endblock %}

{% block buttons %}
<div class="form-group">
  <label class="col-md-4 control-label" for="button1id"></label>

  <div class="col-md-12">
    <button id="button1id" name="button1id" class="btn btn-danger">Registrar Nuevo Asistente</button>
    <button id="button2id" name="button2id" class="btn btn-success">Marcar como Presente</button>
    <button type="button" class="btn btn-info" data-toggle="modal" data-target="#QRModal">Scanear QR</button>
  </div>
</div>

<!-- Modal -->
<div id="QRModal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title">{% trans "Center the QR Code in the camara display below "%}</h4>
      </div>
      <div class="modal-body">
        <div id="qr_reader" class="qrcode" style="width:300px;height:300px; margin: 0 auto;">
        </div>
        <span id="error" class="center"></span>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{% endblock %}

{% block other-script %}
    <script src="{% static "manager/bower_components/html5-qrcode/lib/jsqrcode-combined.min.js" %}"></script>
    <script src="{% static "manager/bower_components/html5-qrcode/lib/html5-qrcode.min.js" %}"></script>
    <script>
        $(document).ready(function() {

            var attendeeAutocomplete = $('.autocomplete-light-widget');
            var event = "{{ event_slug }}";

            attendeeAutocomplete.yourlabsWidget().autocomplete.data = {
                'event_slug': event
            };
        });
        $('#QRModal').on('show.bs.modal', function (e) {
          $('#qr_reader').empty();//Prevents stacking
          $('#qr_reader').html5_qrcode(function(data){
          			//Llamar vista correspondiente
                var url = $(location).attr('href');
                $(location).attr("href", url+'/'+data);
          		},
              //Puedo poner los trans aca?
          		function(error){
          			$('#error').html("Problem reading QR. Try manually");
          		}, function(videoError){
          			$('#vid_error').html("Problem with camara. Please, enable access or try manual entry.");
          		}
          	);
          });
          $('#QRModal').on('hidden.bs.modal', function (e) {
            $('#qr_reader').html5_qrcode_stop()
          });
    </script>
{% endblock %}
